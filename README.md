# save-and-restore-api

The repository contains a Python package for communicating with Save-and-Restore service
(CSS Phoebus). The package provides syncronous (thread-based) and asynchronous (asyncio)
versions of the API functions.

## Examples

The following code creates a folder node named "My Folder" under the root node:

```python

from save_and_restore_api import SaveRestoreAPI

with SaveRestoreAPI(base_url="http://localhost:8080/save-restore") as SR:
    SR.auth_set(username="user", password="user_password")

    root_folder_uid = SR.ROOT_NODE_UID
    node={"name": "My Folder", "nodeType": "FOLDER"}

    folder = SR.node_add(root_folder_uid, node=node)

    print(f"Created folder metadata: {folder}")
```

Async version of the same code:

```python

from save_and_restore_api.aio import SaveRestoreAPI

async with SaveRestoreAPI(base_url="http://localhost:8080/save-restore") as SR:
    await SR.auth_set(username="user", password="user_password")

    root_folder_uid = SR.ROOT_NODE_UID
    node={"name": "My Folder", "nodeType": "FOLDER"}

    folder = await SR.node_add(root_folder_uid, node=node)
    print(f"Created folder metadata: {folder}")
```


## `save-and-restore` CLI Tool

The package also provides a simple CLI tool (`save-and-restore`) for performing a small
set of basic operations on the nodes of the Save-and-Restore service. The tool was
primarily developed for creating snapshot configurations based on lists of PVs.
For example, the tool can read a list of PVs from a .sav file generated by IOC autosave
and create a configuration node based on that list. Currently only autosave files
are supported, but support for other formats can be added if needed. The list of
supported functions can also be extended. Current functions are:

- LOGIN: test login credentials;

- CONFIG ADD: create configuration node based on a list of PVs read from a file;

- CONFIG UPDATE: update an existing configuration node based on a list of PVs read from a file;

- CONFIG GET: get information about an existing configuration node, including the list of PVs.

Use `save-and-restore -h` to see the list of options.
